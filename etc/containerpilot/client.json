{
  "consul": "http://{{ .CONSUL_URL }}:8500",
  "preStart": [
    "consul-template",
    "-once",
    "-consul",
    "{{ .CONSUL_URL }}:8500",
    "-template",
    "/code/etc/nginx.conf.ctmpl:/usr/local/nginx/conf/nginx.conf"
  ],
  "services": [
    {
      "name": "nginx",
      "port": 80,
      "health": "curl --fail -s http://localhost/health",
      "poll": 10,
      "ttl": 25
    }
  ],
  "backends": [
    {
      "name": "signal",
      "poll": 3,
      "onChange": [
        "consul-template",
        "-once",
        "-consul",
        "{{ .CONSUL_URL }}:8500",
        "-template",
        "/code/etc/nginx.conf.ctmpl:/usr/local/nginx/conf/nginx.conf:nginx -s reload"
      ]
    }
  ]
}
